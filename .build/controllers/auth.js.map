{
  "version": 3,
  "sources": ["../../controllers/auth.ts"],
  "sourcesContent": ["import passport from 'koa-passport';\nimport { BasicStrategy } from 'passport-http';\nimport { RouterContext } from 'koa-router';\nimport * as users from '../models/users';\n\nconst verifyPassword = (user: any, password: any) => {\n  return user.password === password;\n}\n\npassport.use(new BasicStrategy(async (username, password, done) => {\n  let result : any[] = [];\n  try {\n    result = await users.findByUsername(username);\n  } catch(error){\n    console.error(`Error during authentication from user ${username}: ${error}`);\n    done(null, false);\n  }\n  if(result.length) {\n    const user = result[0];\n    if(verifyPassword(user, password)) {\n      done(null, {user: user});\n    } else {\n      console.log(`Password incorrect for ${username}`);\n      done(null, false);\n    }\n  } else {\n      console.log(`No user found with username ${username}`);\n      done(null, false);\n  }\n}))\n\nexport const basicAuth = async (ctx: RouterContext, next: any) => {\n  await passport.authenticate(\"basic\", {session: false})(ctx, next);\n  if(ctx.status == 401) {\n    ctx.status = 401;\n    ctx.body = {\n      message: 'you are not authorized'\n    };\n  }\n}\n\n// export const basicAuthArticle = /....\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAqB;AACrB,2BAA8B;AAE9B,YAAuB;AAEvB,MAAM,iBAAiB,CAAC,MAAW,aAAkB;AACnD,SAAO,KAAK,aAAa;AAC3B;AAEA,oBAAAA,QAAS,IAAI,IAAI,mCAAc,OAAO,UAAU,UAAU,SAAS;AACjE,MAAI,SAAiB,CAAC;AACtB,MAAI;AACF,aAAS,MAAM,MAAM,eAAe,QAAQ;AAAA,EAC9C,SAAQ,OAAN;AACA,YAAQ,MAAM,yCAAyC,aAAa,OAAO;AAC3E,SAAK,MAAM,KAAK;AAAA,EAClB;AACA,MAAG,OAAO,QAAQ;AAChB,UAAM,OAAO,OAAO;AACpB,QAAG,eAAe,MAAM,QAAQ,GAAG;AACjC,WAAK,MAAM,EAAC,KAAU,CAAC;AAAA,IACzB,OAAO;AACL,cAAQ,IAAI,0BAA0B,UAAU;AAChD,WAAK,MAAM,KAAK;AAAA,IAClB;AAAA,EACF,OAAO;AACH,YAAQ,IAAI,+BAA+B,UAAU;AACrD,SAAK,MAAM,KAAK;AAAA,EACpB;AACF,CAAC,CAAC;AAEK,MAAM,YAAY,OAAO,KAAoB,SAAc;AAChE,QAAM,oBAAAA,QAAS,aAAa,SAAS,EAAC,SAAS,MAAK,CAAC,EAAE,KAAK,IAAI;AAChE,MAAG,IAAI,UAAU,KAAK;AACpB,QAAI,SAAS;AACb,QAAI,OAAO;AAAA,MACT,SAAS;AAAA,IACX;AAAA,EACF;AACF;",
  "names": ["passport"]
}
